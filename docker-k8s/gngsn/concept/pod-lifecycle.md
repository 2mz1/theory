# Pod Lifecycle

## Pod lifetime

- 애플리케이션 컨테이너와 마찬가지로, 파드는 비교적 일시적인 (지속적인 것 보단) 엔티티로 간주된다. 
  - 파드는 종료(재시작 정책에 따라) 또는 삭제될 때까지, 생성되고, 고유 ID(UID)가 할당되고, 남아있는 노드에 스케줄된다. 
  - 만약 노드가 종료되면, 해당 노드에 스케줄된 파드는 타임아웃 기간 후에 삭제되도록 스케줄됨
- 파드는 자체적으로 자가 치유되지 않음
  - 파드가 노드에 스케줄된 후에 해당 노드가 실패하면, 파드는 삭제됨 
  - 마찬가지로, 파드는 리소스 부족 또는 노드 유지 관리 작업으로 인한 축출에서 살아남지 못함 
  - 쿠버네티스는 컨트롤러라 부르는 높은 레벨의(higher-level) 추상화를 사용하는데, 상대적으로 일회성의 파드 인스턴스를 관리하는 작업을 처리

- UID로 정의된 특정 파드는 다른 노드로 절대 "다시 스케줄"되지 않음
  - 대신, 해당 파드는 사용자가 원한다면 이름은 같지만, UID가 다른, 거의 동일한 새 파드로 대체될 수 있음

- 볼륨과 같이 파드와 동일한 lifetime 을 갖는다면, 특정 파드(정확한 UID 포함)가 존재할 때만 그것이 존재함을 의미. 해당 파드가 삭제되고, 동일한 대체 파드가 생성되더라도, 관련된 것들은 폐기되고 새로 생성됨



## Pod phase
- 파드의 `status` 필드: `phase` 필드를 포함하는 `PodStatus` 오브젝트로 정의
- 파드의 `phase` 필드: 파드가 라이프사이클 중 어느 단계에 해당하는지 표현하는 간단한 높은 수준(high-level)의 요약본
  - Phase는 컨테이너나 파드의 관측 정보에 대한 포괄적인 롤업이나, 포괄적인 상태 머신을 표현하도록 의도되지는 않음

**phase에 가능한 값:**

파드 phase의 수와 의미는 엄격하게 지켜짐. 아래 내용 이외에는, 파드와 파드에 주어진 phase 값에 대해서 어떤 사항도 가정되어서는 안됨

| 값	        | 의미                                                                                                                                |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------|
| Pending   | 파드가 쿠버네티스 클러스터에 받아들여졌지만, 하나 이상의 컨테이너가 설정되지 않았고 아직 실행할 준비가 되지 않았다. 여기에는 파드가 스케줄되기 이전까지의 시간 뿐만 아니라 네트워크를 통한 컨테이너 이미지 다운로드 시간도 포함된다. |
| Running   | 파드가 노드에 바인딩되었고, 모든 컨테이너가 생성되었다. 적어도 하나의 컨테이너가 아직 실행 중이거나, 시작 또는 재시작 중에 있다.                                                        |
| Succeeded | 파드에 있는 모든 컨테이너들이 성공적으로 종료되었고, 재시작되지 않을 것이다.                                                                                       |
| Failed    | 파드에 있는 모든 컨테이너가 종료되었고, 적어도 하나 이상의 컨테이너가 실패로 종료되었다. 즉, 해당 컨테이너는 non-zero 상태로 빠져나왔거나(exited) 시스템에 의해서 종료(terminated)되었다.            |
| Unknown   | 어떤 이유에 의해서 파드의 상태를 얻을 수 없다. 이 단계는 일반적으로 파드가 실행되어야 하는 노드와의 통신 오류로 인해 발생한다.                                                         |
	
	
	
	
## Container states

- 전체 파드의 단계뿐 아니라, 쿠버네티스는 파드 내부의 각 컨테이너 상태를 추적
- 컨테이너 라이프사이클 훅(hook)을 사용하여 컨테이너 라이프사이클의 특정 지점에서 실행할 이벤트를 트리거할 수 있음
- 일단 스케줄러가 노드에 파드를 할당하면, kubelet은 컨테이너 런타임을 사용하여 해당 파드에 대한 컨테이너 생성을 시작

**표시될 수 있는 세 가지 컨테이너 상태**: `Waiting`, `Running`, `Terminated`

- 파드의 컨테이너 상태를 확인하려면, `kubectl describe pod <name-of-pod>` 명령어를 사용할 수 있음
- 출력 결과는 해당 파드 내의 각 컨테이너 상태가 표시

각 상태에는 특정한 의미가 있다.

✔️ **Waiting**
만약 컨테이너가 Running 또는 Terminated 상태가 아니면, Waiting 상태이다. 
Waiting 상태의 컨테이너는 시작을 완료하는 데 필요한 작업(예를 들어, 컨테이너 이미지 레지스트리에서 컨테이너 이미지 가져오거나, 
시크릿(Secret) 데이터를 적용하는 작업)을 계속 실행하고 있는 중이다. 
kubectl 을 사용하여 컨테이너가 Waiting 인 파드를 쿼리하면, 컨테이너가 해당 상태에 있는 이유를 요약하는 Reason 필드도 표시된다.

✔️ **Running**
Running 상태는 컨테이너가 문제없이 실행되고 있음을 나타낸다. 
postStart 훅이 구성되어 있었다면, 이미 실행되고 완료되었다. 
kubectl 을 사용하여 컨테이너가 Running 인 파드를 쿼리하면, 컨테이너가 Running 상태에 진입한 시기에 대한 정보도 볼 수 있다.

✔️ **Terminated**
Terminated 상태의 컨테이너는 실행을 시작한 다음 완료될 때까지 실행되었거나 어떤 이유로 실패했다. 
kubectl 을 사용하여 컨테이너가 Terminated 인 파드를 쿼리하면, 이유와 종료 코드 그리고 해당 컨테이너의 실행 기간에 대한 시작과 종료 시간이 표시된다.

컨테이너에 구성된 preStop 훅이 있는 경우, 이 혹은 컨테이너가 Terminated 상태에 들어가기 전에 실행된다.



