# Chapter2 Cluster Architecture



# 노드

- 쿠버네티스 클러스터 내에서 컨테이너 응용프로그램을 실행시키는 컴퓨터
- 물리 또는 가상 컴퓨터로 구성가능

## 노드 종류

- 마스터 노드
    - 클러스터를 제어함
    - 컨트롤 매니저 스케줄러 API서버 등을 관리함
- 워커 노드
    - 컨테이너 응용프로그램이 실행되는 노드



# 컨트롤 플레인

- 쿠버네티스 클러스터를 관리하고 제어하는 중심 제어 시스템의 일부
- 클러스터내의 노드와 워크로드를 관리함

## 컴포넌트

- API 서버
    - 모든 쿠버네티스 컴포넌트간의 통신을 담당함
    - 클러스터 리소스들(노드, Pod, 서비스등)의 생성 수정 조회 삭제 RestAPI를 제공함
- 스케줄러
    - 새로운 pod를 어떤 노드에 할당할지 결정해줌
    - 리소스 가용정책 기타 제한사항을 고려하여 할당함
- 컨트롤 매니저
    - 컨트롤러 매니저는 클러스터의 상태를 검사하고 원하는 상태를 유지하기 위해 필요한 동작을 수행함
    - ReplicaSet, Deployment, StatefulSet 등의 리소스 컨트롤러가 포함됨
- etcd
    - 클러스터의 모든 구성데이터를 저장하는 분상형 key-value 저장소



# 클라우드 컨트롤 매니저

- 쿠버네티스에서 클라우드와 통합된 기능을 제공하기 위한 컨트롤러

## 컴포넌트

- 노드 컨트롤러
    - 클라우드에서 제공하는 가상 머신 인스턴스를 관리함
- 로드 밸런서 컨트롤러(라우트 컨트롤러)
    - 클라우드 로드밸런서와 통합하여 서비스에 대한 로드밸런싱을 수행함
- 볼륨 컨트롤러
    - 클라우드에서 제공하는 스토리지와 연동하여 쿠버네티스 볼륨으로 활용하게함



# 가비지 수집

- 쿠버네티스가 클러스터 자원을 정리하기 위해 사용하는 종합적인 용어
- 정리되는 리소스
    - 종료된 잡
    - 소요자 참조가 없는 오브젝트
    - 사용되지 않은 컨테이너와 이미지
    - 반환 정책이 삭제인 스토리지 클래스에 의해 동적으로 생성된 퍼시스턴스 볼륨
    - 기타등등

## 캐스케이딩 삭제

- 쿠버네티스는 오브젝트를 삭제할 때 더 이상 소유자 참조가 없는지 확인 후 삭제함
- 레플리카셋을 삭제 할 때 남겨진 파드가 없는지 확인 후 삭제함

### 포그라운드 캐스케이딩 삭제

- 삭제하려는 오브젝트가 먼저 `삭제` 상태가 됨
- 소유자 오브젝트가 삭제 중 상태가 된 후 컨트롤러는 종속되는 오브젝트를 삭제함
- 위 시점에서 오브젝트는 더 이상 쿠버네티스API(조회) 를 이용하여 조회 불가

### 백그라운드 캐스케이딩 삭제

- 쿠버네티스 API가 오브젝트를 즉시 삭제 처리함
- 백그라운드에서 컨트롤러가 종속된 오브젝트를 삭제함
- 쿠버네티스는 수동으로 포그라운드 캐스케이딩을 사용하지 않는 이상 기본으로는 백그라운드 캐스케이딩 삭제가